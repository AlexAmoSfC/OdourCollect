<!DOCTYPE HTML PUBLIC>
    
<html>
<head>
  <meta charset="utf-8">

  <title>Odour Collect</title>
  <meta name="description" content="Odour Collect Project">

  <!-- Javascript libraries and style sheets -->
  <link rel="stylesheet" href="assets/leaflet/leaflet.css" />
  <link rel="stylesheet" href="assets/style.css" />
  <script src="assets/leaflet/leaflet.js"></script>
  <script src="assets/jquery-2.2.4.min.js"></script>
  <link href="assets/bootstrap/css/bootstrap.css" rel="stylesheet">
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <link href="assets/jquery-ui/jquery-ui.css" rel="stylesheet">
  <script src="assets/jquery-ui/jquery-ui.js"></script>
  
  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

<body onload="checkLocalStorage()">
    <!-- Navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <a class="navbar-brand" href="index.html" onclick="showIndex()">
                <img alt="Odour Collect Brand Logo" height=120%; style="margin-top: -5px;" src="assets/img/brand_logo.png">
            </a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li id ="index_navbar" class="active"><a href="#" onclick="showIndex()">Odour Collect</a></li>
                <li id ="project_navbar" ><a href="#" onclick="showProject()">The Project</a></li>
                <li id ="methodology_navbar" ><a href="#" onclick="showMethodology()">Methodology</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <!-- Button to sign in -->
                <button type="button" class="btn btn-default navbar-btn" id="sign_in_button">Sign in</button>
                <!-- Text displaying logged in user name -->
                <p class="navbar-text" style="display:none;" id="signed_in_text">Signed in as <span id="user_name_navtext"></span></p>
            </ul>
        </div><!-- /.navbar-collapse -->
    </nav><!-- navbar -->
    <div id="content">
        
        <!-- Different pages within the web -->
        
        <!-- Map section -->
        <div id="map_content">
            <div id="map">
                <button type="button" class="btn btn-default navbar-btn" id="add_report_button" onClick="addReportShow()"><img alt="Odour Collect Brand Logo" style="height: 28px; margin-right: 10px;" src="assets/img/brand_logo.png">Add report</button>
            </div>
            <div id="filter_section">
                <label for="type_filter">Filter by type of odour and/or by date</label><br>
                <select id="type_filter">
                    <option disabled value="0">Select Type of Odour</option>
                    <option value="1">Garbage</option>
                    <option value="2">Sewage</option>
                    <option value="3">Chemical</option>
                    <option value="4">I do not know</option>
                    <option value="5">Other</option>
                </select>
                <span id="date_picker_filter">
                    <label for="from">From</label>
                    <input type="text" id="from" name="from">
                    <label for="to">to</label>
                    <input type="text" id="to" name="to">
                </span>
                <button type="button" class="btn btn-default navbar-btn" onClick="filter()">Filter</button>
            </div>
            <div id="reports_section">
                <div id="reports">
                </div>
                <div id="pagination_content">
                    <div class="pagination">
                        <ul class="pager"></ul>
                    </div> 
                </div>
            </div>
            <div id="user_section" style="display: none;">
                <div id="user_info" class="col-md-2">
                </div>
                <div id="user_reports_section" class="col-md-10">
                    <div id="user_reports">
                    </div>
                    <div id="user_pagination_content">
                        <div class="user_pagination">
                            <ul class="user_pager"></ul>
                        </div> 
                    </div>
                </div>
                <div class="spacer" style="clear: both;"></div>
            </div>
            <div id="report_section" style="display: none;">
                <div id="report_info" class="col-md-6">
                </div>
                <div id="report_comments_section" class="col-md-6">
                    <div id="report_comments">
                    </div>
                    <textarea rows="4" cols="40" id="add_comment_textarea" value="" class="text ui-widget-content ui-corner-all"></textarea><br>
                    <button type="button" class="btn btn-default navbar-btn" id="add_comment_button" onClick="addComment()">Add comment</button>
                </div>
                <div class="spacer" style="clear: both;"></div>
            </div>
        </div>
        
        <!-- Project section -->
        <div id="project" style="display:none;">
            OdourCollect is the App to report your odour complaints. Use the power of your nose: Smell and share!<br><br>
            Have you ever experience odour nuisance at home or at your working place? Do you know where to set up a complaint? Frequent exposure to annoying odours can cause headache, stress or lack of concentration, thus reducing your quality of life. Even though odour complaints are one of the main environmental problems in the EU, there is not specific legislation to control the problem, meaning that citizens are defenceless!<br><br> 
            OdourCollect provides a tool to empower citizens, who are suffering from regular odour nuisance, to report the incidence to the world. Odour maps are build based on crowd-sourced odour reports to calculate frequencies and levels of nuisance. Just log in and start reporting, anytime, everywhere! Your nose is indeed the best odour sensor available. Resulting odour maps are open for public consultation and could eventually be used to demonstrate the problem and ask for action to the relevant stakeholders, with the aim of eliminating or significantly reducing the nuisance, thus improving your quality of life.<br><br> 
            The project is being developed within the frame of MYGEOSS, a two-year European project (2015-2016) by the European Commission to develop GEOSS-based (Global Earth Observation System of Systems) smart Internet applications informing European citizens on the changes affecting their local environment. OdourCollect is one of the 66 winners from 15 European countries of the third MYGEOSS open call for innovative ideas. We need you for project success!<br><br> 
            Odour Collect software is released under GPLv3 (GNU General Public License versión 3) in <a href="https://github.com/Ibercivis/OdourCollect" target="_blank">Github</a>. Data is open data released under EUPL license and available through a webservice and downloadable <a href="http://odourcollect.socientize.eu/webservice/getopendata.php" target="_blank">here</a>. The Data Management Plan for the project is available <a href="assets/OdourCollect_DMP_v1.pdf" target="_blank">here</a>. And the deliverable for MyGeoss about the project <a href="assets/MYGEOSS_Deliverable.pdf" target="_blank">here</a>.
        </div>
        
        <!-- Methodology section -->
        <div id="methodology" style="display:none;">
            OdourCollect is based on a standardized European methodology to evaluate odour episodes through crowd-sourced citizens' observations: the German standard VDI 3940:2006 (Measurement of odour impact by field inspection: measurement of the impact frequency of recognizable odours), soon to become the European standard CEN 16841.<br> 
            Although the standard defines a strict methodology to measure odours during a certain time in a specific area, where the nuisance is localised, with a specific duration and a certain number of measurements performed by certified standard human “noses” or observers, OdourCollect adapts the methodology with the aim of first identifying those complaint areas where the quality of life is jeopardised by frequent odour exposure. Any citizen can act as the observer and collect geo-localised open data on the odour episode, both in space and time, which can be used to build odour complaint maps. Yes, you too! Yours' and your neighbours' observations will demonstrate the problem, thus empowering citizens to claim for solutions. Based on the identified odour maps, scientific odour studies could be deployed on the area to technically characterise the odour problem and find the keys to eliminate it.<br>
            Reporting an odour complaint with OdourCollect will take just a couple of minutes. After logging in, you will need to fill in the following information:<br>
            -	Day and hour of the odour perception (automatically done by the App)<br><br>

            -	Type of odour perceived (if known, you can always guess!). You can choose between:<br><br>
            &emsp;o	Garbage<br>
            &emsp;o	Sewage<br>
            &emsp;o	Chemical<br>
            &emsp;o	I do not know<br>
            &emsp;o	Other<br><br>

            -	Odour intensity, in a scale of 1 to 6, based on standard VDI 3882 Part 1: Determination of odour intensity:<br><br>
            &emsp;o	1: Very weak (it is difficult to perceive it)<br>
            &emsp;o	2: Weak (almost everybody can notice an odour in the ambient air)<br>
            &emsp;o	3: Distinct (an odour is clearly present in the air by everybody)<br>
            &emsp;o	4: Strong (the odour starts to annoy)<br>
            &emsp;o	5: Very strong (the odour is clearly annoying)<br>
            &emsp;o	6: Extremely strong (the odour is almost unbearable)<br><br> 

            -	Level of annoyance, from -4 (if the odour is unpleasant) to 0 (neutral) and to 4 (if the odour is pleasant), based on standard VDI 3882 Part 2: Determination of hedonic odour tone:<br><br>

            -	Meteorological conditions during the odour episode. Please observe:<br><br>
            &emsp;o	Cloud coverage: from 0 to 8 (divide the sky in 8 parts and count how many of them are covered by clouds)<br>
            &emsp;o	Rain: from 0 to 5, being 5 a torrential rain.<br>
            &emsp;o	Wind: from 0 to 4, being 0 no wind, 1 very weak wind, 2 weak-distinct wind, 3 strong wind and 4 hurricane wind.<br><br>

            -	Where does the odour come from (if known or suspected)?<br><br>

            -	Duration of the odour episode. Please select:<br><br>
            &emsp;o	Less than 1 minute<br>
            &emsp;o	1 - 5 min<br>
            &emsp;o	More than 10 minutes<br><br>
                                                
            If you are not interested in reporting an odour episode but are curious about the odours perceived in your area, just check the map and the odour reports filled up by other citizens. You will be able to check on data intensity or level on annoyance, and to filter the map by type of odour or by date. Feel free to navigate and to become and odour hound!<br> 
            Thanks for participating in this citizen science experiment, helping us to build up odour maps!<br>

        </div>
        
        <!-- Input forms dialogs -->
        
        <!-- Login dialog -->
        <div id="dialog-form-login" title="Sign user in">
            <p class="validateTips">All form fields are required.</p>
         
            <form id="login_form">
                <fieldset>
                    <label for="name_login">Name</label><br>
                    <input type="text" name="name" id="name_login" value="" class="text ui-widget-content ui-corner-all"><br>
                    <label for="password_login">Password</label><br>
                    <input type="password" name="password" id="password_login" value="" class="text ui-widget-content ui-corner-all"><br>
             
                    <!-- Allow form submission with keyboard without duplicating the dialog button -->
                    <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
                </fieldset>
            </form>
        </div>
        
        <!-- Sign up dialog -->
        <div id="dialog-form-signup" title="Sign up">
            <p class="validateTips">All form fields are required.</p>
         
            <form id="signup_form">
                <fieldset>
                    <label for="name_signup">Name</label><br>
                    <input type="text" name="name" id="name_signup" value="" class="text ui-widget-content ui-corner-all"><br>
                    <label for="email_signup">Email</label><br>
                    <input type="text" name="email" id="email_signup" value="" class="text ui-widget-content ui-corner-all"><br>
                    <label for="password_signup">Password</label><br>
                    <input type="password" name="password" id="password_signup" value="" class="text ui-widget-content ui-corner-all"><br>
                    <label for="age_signup">Age</label><br>
                    <select name="age" id="age_signup">
                        <option disabled value="0" selected="selected">Select Age</option>
                        <option value="1">&#60;18</option>
                        <option value="2">18-40</option>
                        <option value="3">&#62;40</option>
                    </select><br>
                    <label for="gender_signup">Gender</label><br>
                    <select name="gender" id="gender_signup">
                        <option disabled value="0">Select Gender</option>
                        <option value="1">Female</option>
                        <option value="2">Male</option>
                    </select><br>
            	    <p>
			<br><b>INFORMED CONSENT</b><br>
			By clicking Sign Up, you allow reuse of data collected under EUPL license.
		    </p> 
                    <!-- Allow form submission with keyboard without duplicating the dialog button -->
                    <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
                </fieldset>
            </form>
        </div>
        
        <!-- Add report dialog -->
        <div id="dialog-form-addreport" title="Add report">
            <p class="validateTips">All form fields are required.</p>
         
            <form id="addreport_form">
                <fieldset>
                    <label for="type_addreport">Type of odour</label><br>
                    <select id="type_addreport" onchange="showHideOtherInputText()" >
                        <option disabled value="0">Select Type of Odour</option>
                        <option value="1">Garbage</option>
                        <option value="2">Sewage</option>
                        <option value="3">Chemical</option>
                        <option value="4">I do not know</option>
                        <option value="5">Other</option>
                    </select><br>
                    <input type="text" name="name" id="other_addreport" value="" class="text ui-widget-content ui-corner-all" style="display: none;"><br>
                    <label>Is it a strong odour?&nbsp;&nbsp;</label><span id="intensity_text">1</span><br>
                    <div id="intensity_addreport"></div><br>
                    <label>Is it a nice or foul odour?&nbsp;&nbsp;</label><span id="annoyance_text">-4</span><br>
                    <div id="annoyance_addreport"></div><br>
                    <label>What is the weather like?&nbsp;&nbsp;</label><br>
                    <span>Cloud coverage:&nbsp;&nbsp;</span><span id="cloud_text">1</span><br>
                    <div id="cloud_addreport"></div><br>
                    <span>Rain:&nbsp;&nbsp;</span><span id="rain_text">0</span><br>
                    <div id="rain_addreport"></div><br>
                    <span>Wind:&nbsp;&nbsp;</span><span id="wind_text">0</span><br>
                    <div id="wind_addreport"></div><br>
                    <label for="origin_addreport">Where does the odour come from?</label><br>
                    <input type="text" name="name" id="origin_addreport" value="" class="text ui-widget-content ui-corner-all"><br>
                    <label for="duration_addreport">What was the episode duration?</label><br>
                    <select id="duration_addreport">
                        <option disabled value="0">Select Duration</option>
                        <option value="1">&#60; 1min</option>
                        <option value="2">1-5 min</option>
                        <option value="3">&#62; 10min</option>
                    </select><br>
             
                    <!-- Allow form submission with keyboard without duplicating the dialog button -->
                    <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">
                </fieldset>
            </form>
        </div>
        
        <!-- Information and error dialogs -->
        
        <div id="dialog-login-todo" title="Log in">
            <p>You are not logged in, please log in.</p>
        </div>

        <div id="dialog-recorded" title="Add report">
            <p>The report has been recorded.</p>
        </div>

        <div id="dialog-filter-not-selected" title="Log in">
            <p>No filter option has been selected or the date range is not defined.</p>
        </div>
        
        <div id="footer">
            <a href="http://www.ibercivis.es/"><img alt="Ibercivis Logo" width=15%; id="ibercivis_logo_img" src="http://www.ibercivis.es/wp-content-rename/uploads/2013/06/Logo_Ibercivis_RGB.jpg"></a>
            <a href=""><img alt="MYGEOSS Logo" id="mygeoss_logo_img" src="http://digitalearthlab.jrc.ec.europa.eu/mygeoss/images/logoxxx.png"></a>
            <a href=""><img alt="EC Logo" id="ec_logo_img" src="https://upload.wikimedia.org/wikipedia/en/thumb/8/84/European_Commission.svg/1280px-European_Commission.svg.png"></a>
        </div>
    </div><!-- content -->
    
    <script>
    
        $('#mygeoss_logo_img').height($("#ibercivis_logo_img").height());
        $('#ec_logo_img').height($("#ibercivis_logo_img").height());

        // Auxiliar variables definition
        var adding_report = false,
        modal_open = false,
        latlng_aux;
        
        var fromSelected = false,
        toSelected = false,
        fromDate,
        toDate;
        
        // Pagination variables
        var listElement = $('#reports');
        var perPage = 5; 
        var numItems = listElement.children().size();
        var numPages = Math.ceil(numItems/perPage);
        var curr;
        
        // Pagination variables
        var userListElement = $('#user_reports');
        var userPerPage = 4; 
        var userNumItems = userListElement.children().size();
        var userNumPages = Math.ceil(userNumItems/userPerPage);
        var userCurr;
        
        
        // Urls definition
/*        var urlAddreport = 'http://odourcollect.socientize.eu/addreport',
        urlLogin = 'http://odourcollect.socientize.eu/login',
        urlSignup = 'http://odourcollect.socientize.eu/signup',
        urlReports = 'http://odourcollect.socientize.eu/getreports',
        urlGetuser = 'http://odourcollect.socientize.eu/getuser'
        urlGetreport = 'http://odourcollect.socientize.eu/getreport.php'
        urlAddcomment = 'http://odourcollect.socientize.eu/addcomment.php';*/
        
/*        var urlAddreport = 'http://localhost/webservice/addreport.php',
        urlLogin = 'http://localhost/webservice/login.php',
        urlSignup = 'http://localhost/webservice/signup.php',
        urlReports = 'http://localhost/webservice/getreports.php',
        urlGetuser = 'http://localhost/webservice/getuser.php',
        urlGetreport = 'http://localhost/webservice/getreport.php'
        urlAddcomment = 'http://localhost/webservice/addcomment.php';
*/

        var urlAddreport = 'http://modulos.ibercivis.es/webservice/addreport.php',
        urlLogin = 'http://modulos.ibercivis.es/webservice/login.php',
        urlSignup = 'http://modulos.ibercivis.es/webservice/signup.php',
        urlReports = 'http://modulos.ibercivis.es/webservice/getreports.php',
        urlGetuser = 'http://modulos.ibercivis.es/webservice/getuser.php',
        urlGetreport = 'http://modulos.ibercivis.es/webservice/getreport.php'
        urlAddcomment = 'http://modulos.ibercivis.es/webservice/addcomment.php';



        
        // Map definition
        var map = L.map('map');
                
        L.tileLayer('https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: '',
            maxZoom: 18,
            accessToken: 'pk.eyJ1IjoiZWR1YmlmaSIsImEiOiJjaW9sbG9zaXUwMDJvdzlseWkxMHQyb2MwIn0.e-J4brbdwiVbdOEummCCWw'
        }).addTo(map);
        
        var markerArray = new Array();
        
        // Callback function when location is required
        function onLocationFound(e) {

            if (adding_report == true) {
                // Location while adding a report
                addReport(e.latlng);
            }
            else {
                // Initial location
            }
        }

        map.on('locationfound', onLocationFound);

        function onLocationError(e) {
            alert(e.message);
        }

        map.on('locationerror', onLocationError);
            
        map.locate({setView: true, maxZoom: 13});
        
        /*---------------------------------------
          Sliders declaration
        ---------------------------------------*/
        
        $( "#intensity_addreport" ).slider({
            value:1,
            min: 1,
            max: 6,
            step: 1,
            slide: function( event, ui ) {
                $( "#intensity_text" ).text( ui.value );
            }
        });
        
        $( "#annoyance_addreport" ).slider({
            value:-4,
            min: -4,
            max: 4,
            step: 1,
            slide: function( event, ui ) {
                $( "#annoyance_text" ).text( ui.value );
            }
        });
        
        $( "#cloud_addreport" ).slider({
            value:1,
            min: 1,
            max: 8,
            step: 1,
            slide: function( event, ui ) {
                $( "#cloud_text" ).text( ui.value );
            }
        });
        
        $( "#rain_addreport" ).slider({
            value:0,
            min: 0,
            max: 5,
            step: 1,
            slide: function( event, ui ) {
                $( "#rain_text" ).text( ui.value );
            }
        });
        
        $( "#wind_addreport" ).slider({
            value:0,
            min: 0,
            max: 4,
            step: 1,
            slide: function( event, ui ) {
                $( "#wind_text" ).text( ui.value );
            }
        });
        
        /*---------------------------------------
          Callback and dialog management functions
        ---------------------------------------*/
            
        function addReportShow () {
            
            console.log("add report show");
            
            if ((localStorage.user_logged_in != undefined) && (localStorage.user_logged_in != null) && (localStorage.user_logged_in != false)) {
                
                dialogAddreport.dialog( "open" );
                modal_open = true;
            }
            else {
                $( "#dialog-login-todo" ).dialog( "open" );
                modal_open = true;
            }
        }
        
        function showHideOtherInputText() {
            
            if ($("#type_addreport").val() == 5) {
                // Show other input text
                $("#other_addreport").show();
            }
            else {
                // Hide other input text
                $("#other_addreport").hide();
            }
        }
        
        function addReport(latlng) {
            
            console.log("add report "+latlng);
            
            latlng_aux = "" + latlng;

            JSONdata = { "other_type": other_addreport.val(), "origin" : origin_addreport.val(), "type" : $( "#type_addreport option:selected" ).text(), "duration" : $( "#duration_addreport option:selected" ).text(), 
                                        "intensity" : $('#intensity_addreport').slider("option", "value"), "annoyance" : $('#annoyance_addreport').slider("option", "value"), "cloud" : $('#cloud_addreport').slider("option", "value"), 
                                        "rain" : $('#rain_addreport').slider("option", "value"), "wind" : $('#wind_addreport').slider("option", "value"), "latlng" : latlng_aux, "user" : localStorage.user_name };
            
            latlng_aux =latlng;
             
            // Send data to the back-end
            $.post( urlAddreport, JSONdata, null, "json" )
                .done(function( data, textStatus, jqXHR ) {
                    console.log( "La solicitud se ha completado correctamente." );
                    if (data["result"] == 0)
                        addreportFail("Error while adding a new report: " + data["message"]);
                    else addreportOk(data);
                })
                .fail(function( jqXHR, textStatus, errorThrown ) {
                    console.log( "La solicitud ha fallado: " +  textStatus);
                    addreportFail("Error while adding a new report");
            });
        }
        
        function signupShow () {
            
            console.log("signup show");
            
            dialogLogin.dialog( "close" );
            
            dialogSignup.dialog( "open" );
            modal_open = true;
        }
                
        /*-----------------------------------------------
          Variable definitions for dialogs management
        -----------------------------------------------*/
        
        // From http://www.whatwg.org/specs/web-apps/current-work/multipage/states-of-the-type-attribute.html#e-mail-state-%28type=email%29
        var emailRegex = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,
        name_login = $( "#name_login" ),
        password_login = $( "#password_login" ),
        allFieldsLogin = $( [] ).add( name_login ).add( password_login ),
        
        name_signup = $( "#name_signup" ),
        email_signup = $( "#email_signup" ),
        password_signup = $( "#password_signup" ),
        age_signup = $( "#age_signup" ),
        gender_signup = $( "#gender_signup" ),
        allFieldsSignup = $( [] ).add( name_signup ).add( email_signup ).add( password_signup ).add( age_signup ).add( gender_signup ),
        
        other_addreport = $( "#other_addreport" ),
        origin_addreport = $( "#origin_addreport" ),
        type_addreport = $( "#type_addreport" ),
        intensity_addreport = $( "#intensity_addreport" ),
        annoyance_addreport = $( "#annoyance_addreport" ),
        cloud_addreport = $( "#cloud_report" ),
        rain_addreport = $( "#rain_addreport" ),
        wind_addreport = $( "#wind_addreport" ),
        duration_addreport = $( "#duration_addreport" ),
        allFieldsAddreport = $( [] ).add( other_addreport ).add( type_addreport ).add( origin_addreport ).add( duration_addreport ),
 
        tips = $( ".validateTips" );
         
         /*-------------------------------------------
          Util functions for dialogs verification
        -------------------------------------------*/
         
        function updateTips( t ) {
            tips
                .text( t )
                .addClass( "ui-state-highlight" );
            setTimeout(function() {
                tips.removeClass( "ui-state-highlight", 1500 );
            }, 500 );
        }
         
        function checkLength( o, n, min, max ) {
            if ( o.val().length > max || o.val().length < min ) {
                o.addClass( "ui-state-error" );
                updateTips( "Length of " + n + " must be between " +
                  min + " and " + max + "." );
                return false;
            } else {
                return true;
            }
        }
         
        function checkRegexp( o, regexp, n ) {
            if ( !( regexp.test( o.val() ) ) ) {
                o.addClass( "ui-state-error" );
                updateTips( n );
                return false;
            } else {
                return true;
            }
        }
        
        function checkSelect( o ) {
        
            if ((o.val() == 0) || (o.val() == null)) {
                o.addClass( "ui-state-error" );
                updateTips( "You must select one of the options from the drop-down." );
                return false;
            }
            return true;
        }
        
        /*---------------------------------------
          Dialogs callback functions
        ---------------------------------------*/
        
        // Function to confirm user login
        function loginUser() {
            var valid = true;
            allFieldsLogin.removeClass( "ui-state-error" );
         
            valid = valid && checkLength( name_login, "name", 3, 16 );
            valid = valid && checkLength( password_login, "password", 5, 16 );
         
            valid = valid && checkRegexp( name_login, /^[a-z]([0-9a-z_\s])+$/i, "Username may consist of a-z, 0-9, underscores, spaces and must begin with a letter." );
            valid = valid && checkRegexp( password_login, /^([0-9a-zA-Z])+$/, "Password field only allow : a-z 0-9" );
         
            if ( valid ) {
                // Login success
                
                // Send data to the back-end
                JSONdata = { "username": name_login.val(), "password" : password_login.val() };
                $.post( urlLogin, JSONdata, null, "json" )
                    .done(function( data, textStatus, jqXHR ) {
                        console.log( "La solicitud se ha completado correctamente." );
                        if (data["result"] == 0)
                            loginFail("Error while login: " + data["message"]);
                        else loginOk(data);
                    })
                    .fail(function( jqXHR, textStatus, errorThrown ) {
                        console.log( "La solicitud ha fallado: " +  textStatus);
                        loginFail("Error while login");
                });
                
            }
            
            return valid;
        }
        
        // Function to confirm user signup
        function signupUser() {
            var valid = true;
            allFieldsLogin.removeClass( "ui-state-error" );
         
            valid = valid && checkLength( name_signup, "name", 3, 16 );
            valid = valid && checkLength( email_signup, "email", 6, 80 );
            valid = valid && checkLength( password_signup, "password", 5, 16 );
         
            valid = valid && checkRegexp( name_signup, /^[a-z]([0-9a-z_\s])+$/i, "Username may consist of a-z, 0-9, underscores, spaces and must begin with a letter." );
            valid = valid && checkRegexp( email_signup, emailRegex, "eg. user@odourcollect.com" );
            valid = valid && checkRegexp( password_signup, /^([0-9a-zA-Z])+$/, "Password field only allow : a-z 0-9" );
            
            valid = valid && checkSelect( age_signup );
            valid = valid && checkSelect( gender_signup );
            
            if ( valid ) {
                // User signup
                                
                // Send data to the back-end
                JSONdata = { "username": name_signup.val(), "email" : email_signup.val(), "password" : password_signup.val(), "age" : $( "#age_signup option:selected" ).text(), "gender" : $( "#gender_signup option:selected" ).text() };
                $.post( urlSignup, JSONdata, null, "json" )
                    .done(function( data, textStatus, jqXHR ) {
                        console.log( "La solicitud se ha completado correctamente." );
                        if (data["result"] == 0)
                            signupFail("Error while signup: " + data["message"]);
                        else signupOk(data);
                    })
                    .fail(function( jqXHR, textStatus, errorThrown ) {
                        console.log( "La solicitud ha fallado: " +  textStatus);
                        signupFail("Error while signup");
                });
            }
            
            return valid;
        }
        
        // Function to confirm user signup
        function addReportSubmit() {
            var valid = true;
            allFieldsAddreport.removeClass( "ui-state-error" );
         
            if (type_addreport.val() == 5)
                valid = valid && checkLength( other_addreport, "other", 3, 25 );
            valid = valid && checkLength( origin_addreport, "origin", 3, 25 );
            
            if (type_addreport.val() == 5)
                valid = valid && checkRegexp( other_addreport, /^[a-z]([0-9a-z_\s])+$/i, "Other type of odour may consist of a-z, 0-9, underscores, spaces and must begin with a letter." );
            valid = valid && checkRegexp( origin_addreport, /^[a-z]([0-9a-z_\s])+$/i, "Origin may consist of a-z, 0-9, underscores, spaces and must begin with a letter." );
            
            valid = valid && checkSelect( type_addreport );
            valid = valid && checkSelect( duration_addreport );

            if ( valid ) {
                // Everything is ok for addition
                
                // Locate report
                adding_report = true;
                map.locate({setView: true, maxZoom: 16}); 
            }
            
            return valid;
        }
        
        /*---------------------------------------
          Dialog definitions
        ---------------------------------------*/
        
        dialogLogin = $( "#dialog-form-login" ).dialog({
            autoOpen: false,
            height: 300,
            width: 350,
            modal: true,
            buttons: {
                "Login": loginUser,
                "Sign Up": signupShow,
                Cancel: function() {
                  dialogLogin.dialog( "close" );
                  modal_open = false;
                }
            },
            close: function() {
                formLogin[ 0 ].reset();
                allFieldsLogin.removeClass( "ui-state-error" );
                modal_open = false;
            }
        });
         
        formLogin = dialogLogin.find( "#login_form" ).on( "submit", function( event ) {
            event.preventDefault();
            loginUser();
        });
        
        dialogSignup = $( "#dialog-form-signup" ).dialog({
            autoOpen: false,
            modal: true,
            buttons: {
                "Sign Up": signupUser,
                Cancel: function() {
                  dialogSignup.dialog( "close" );
                  modal_open = false;
                }
            },
            close: function() {
                formSignup[ 0 ].reset();
                allFieldsSignup.removeClass( "ui-state-error" );
                $('#age_signup>option:eq(0)').prop('selected', true);
                $('#gender_signup>option:eq(0)').prop('selected', true);
                
                modal_open = false;
            }
        });
         
        formSignup = dialogSignup.find( "#signup_form" ).on( "submit", function( event ) {
            event.preventDefault();
            signupUser();
        });
        
        dialogAddreport = $( "#dialog-form-addreport" ).dialog({
            autoOpen: false,
            modal: true,
            buttons: {
                "Add report": addReportSubmit,
                Cancel: function() {
                  dialogAddreport.dialog( "close" );
                  modal_open = false;
                }
            },
            close: function() {
                // Init forms, inputs, sliders and labels
                formAddreport[ 0 ].reset();
                allFieldsAddreport.removeClass( "ui-state-error" );
                $('#type_addreport>option:eq(0)').prop('selected', true);
                $('#duration_addreport>option:eq(0)').prop('selected', true);
                
                $("#intensity_addreport").slider('value',1);
                $("#annoyance_addreport").slider('value',-4);
                $("#cloud_addreport").slider('value',1);
                $("#rain_addreport").slider('value',0);
                $("#wind_addreport").slider('value',0);
                
                $( "#intensity_text" ).text( 1 );
                $( "#annoyance_text" ).text( -4 );
                $( "#cloud_text" ).text( 1 );
                $( "#rain_text" ).text( 0 );
                $( "#wind_text" ).text( 0 );
                
                modal_open = false;
            }
        });
         
        formAddreport = dialogAddreport.find( "#addreport_form" ).on( "submit", function( event ) {
            event.preventDefault();
            addReportUser();
        });
         
        $( "#dialog-login-todo" ).dialog({
            autoOpen: false,
            show: {
                effect: "blind",
                duration: 1000
            },
            hide: {
                effect: "blind",
                duration: 1000
            },
            buttons: {
                Ok: function() {
                    $( "#dialog-login-todo" ).dialog( "close");
                }
            },
            close: function() {
                dialogLogin.dialog( "open" );
            }
        });
      
      $( "#dialog-recorded" ).dialog({
            autoOpen: false,
            show: {
                effect: "blind",
                duration: 1000
            },
            hide: {
                effect: "blind",
                duration: 1000
            },
            buttons: {
                Ok: function() {
                    $( "#dialog-recorded" ).dialog( "close");
                    modal_open = false;
                }
            },
            close: function() {
                modal_open = false;
            }
        });
        
        $( "#dialog-filter-not-selected" ).dialog({
            autoOpen: false,
            show: {
                effect: "blind",
                duration: 1000
            },
            hide: {
                effect: "blind",
                duration: 1000
            },
            buttons: {
                Ok: function() {
                    $( "#dialog-filter-not-selected" ).dialog( "close");
                    modal_open = false;
                }
            },
            close: function() {
                modal_open = false;
            }
        });
        
        $(function() {
            $( "#from" ).datepicker({
              defaultDate: "+1w",
              changeMonth: true,
              numberOfMonths: 3,
              onSelect: function(selectedDate){
                fromSelected = true;
                fromDate = selectedDate;
              },
              onClose: function( selectedDate ) {
                $( "#to" ).datepicker( "option", "minDate", selectedDate );
              }
            });
            $( "#to" ).datepicker({
              defaultDate: "+1w",
              changeMonth: true,
              numberOfMonths: 3,
              onSelect: function(selectedDate){
                toSelected = true;
                toDate = selectedDate;
              },
              
              onClose: function( selectedDate ) {
                $( "#from" ).datepicker( "option", "maxDate", selectedDate );
              }
            });
          });
        
        /*---------------------------------------
          Log in extra functions
        ---------------------------------------*/
        
        $( "#sign_in_button" ).button().on( "click", function() {
            dialogLogin.dialog( "open" );
            modal_open = true;
        });
        
        function checkLocalStorage () {
            if ((localStorage.user_logged_in != undefined) && (localStorage.user_logged_in != null) && (localStorage.user_logged_in != false)) {
                $("#sign_in_button").hide();
                $("#signed_in_text").show();
                $("#user_name_navtext").text(localStorage.user_name);
            }
            else console.log("Not logged in");
        }
        
        /*---------------------------------------
          Functions to manage pages visibility
        ---------------------------------------*/
        
        function showIndex () {
            if (modal_open == false) {
                // Show/Hide the proper div
                $("#map_content").show();
                $("#project").hide();
                $("#methodology").hide();
                
                // Add/Remove the active class to the proper div
                $("#index_navbar").addClass( "active" );
                $("#project_navbar").removeClass( "active" );
                $("#methodology_navbar").removeClass( "active" );
            }
        }
        
        function showProject () {
            if (modal_open == false) {
                // Show/Hide the proper div
                $("#map_content").hide();
                $("#project").show();
                $("#methodology").hide();
                
                // Add/Remove the active class to the proper div
                $("#index_navbar").removeClass( "active" );
                $("#project_navbar").addClass( "active" );
                $("#methodology_navbar").removeClass( "active" );
            }
        }
        
        function showMethodology () {
            if (modal_open == false) {
                // Show/Hide the proper div
                $("#map_content").hide();
                $("#project").hide();
                $("#methodology").show();
                
                // Add/Remove the active class to the proper div
                $("#index_navbar").removeClass( "active" );
                $("#project_navbar").removeClass( "active" );
                $("#methodology_navbar").addClass( "active" );
            }
        }
        
        function showUser (username) {
            // Show/Hide the proper div
            $("#reports_section").hide();
            $("#user_section").show();
            $("#report_section").hide();
            
            // Send data to the back-end
            JSONdata = { "username": localStorage.user_name };
                $.post( urlGetuser, JSONdata, null, "json" )
                    .done(function( data, textStatus, jqXHR ) {
                        console.log( "La solicitud se ha completado correctamente." );
                        if (data["result"] == 0)
                            getuserFail("Error while getting user: " + data["message"]);
                        else getuserOk(data);
                    })
                    .fail(function( jqXHR, textStatus, errorThrown ) {
                        console.log( "La solicitud ha fallado: " +  textStatus);
                        getuserFail("Error while getting user");
                });
        }

        function showReport (id) {
            // Show/Hide the proper div
            $("#reports_section").hide();
            $("#user_section").hide();
            $("#report_section").show();
            
            // Send data to the back-end
            JSONdata = { "report_id": id };
                $.post( urlGetreport, JSONdata, null, "json" )
                    .done(function( data, textStatus, jqXHR ) {
                        console.log( "La solicitud se ha completado correctamente." );
                        if (data["result"] == 0)
                            getreportFail("Error while getting the report: " + data["message"]);
                        else getreportOk(data);
                    })
                    .fail(function( jqXHR, textStatus, errorThrown ) {
                        console.log( "La solicitud ha fallado: " +  textStatus);
                        getreportFail("Error while getting the report");
                });
        }

        function addComment () {
            
            if ((localStorage.user_logged_in != undefined) && (localStorage.user_logged_in != null) && (localStorage.user_logged_in != false)) {
                
                // Send data to the back-end
                JSONdata = { "report_id": localStorage.report_id, "comment": $('textarea#add_comment_textarea').val(), "user": localStorage.user_name};
                    $.post( urlAddcomment, JSONdata, null, "json" )
                        .done(function( data, textStatus, jqXHR ) {
                            console.log( "La solicitud se ha completado correctamente." );
                            if (data["result"] == 0)
                                addcommentFail("Error while adding the comment: " + data["message"]);
                            else addcommentOk(data);
                        })
                        .fail(function( jqXHR, textStatus, errorThrown ) {
                            console.log( "La solicitud ha fallado: " +  textStatus);
                            addcommentFail("Error while adding the comment");
                    });
            }
            else {
                $( "#dialog-login-todo" ).dialog( "open" );
                modal_open = true;
            }
        }
        
        function filter () {
            
            if (checkSelect( $( "#type_filter" ) ) || (fromSelected && toSelected)) {
                
                // Clean the select
                $( "#type_filter" ).removeClass( "ui-state-error" );
                $( "#from" ).removeClass( "ui-state-error" );
                $( "#to" ).removeClass( "ui-state-error" );
                
                // Make all visible
                $.each(markerArray, function(index, element) {
                    map.addLayer(element[0]);
                });
                
                // Filter by type
                if ($( "#type_filter option:selected" ).text() != "Select Type of Odour") {
                    $.each(markerArray, function(index, element) {
                        if (element[1] != $( "#type_filter option:selected" ).text()) {
                            map.removeLayer(element[0]);
                        }
                    });
                }
                
                // Filter by date
                if (fromSelected && toSelected) {
                
                    fromDate = $("#from").datepicker("getDate");
                    toDate = $("#to").datepicker("getDate");
                    
                    $.each(markerArray, function(index, element) {
                        // Convert SQL date to JavaScript date (from here: http://stackoverflow.com/questions/3075577/convert-mysql-datetime-stamp-into-javascripts-date-format)
                        var t = element[2].split(/[- :]/);

                        // Apply each element to the Date function
                        var auxDate = new Date(t[0], t[1]-1, t[2], t[3], t[4], t[5]);
                        
                        // Filter by starting date
                        if ((fromDate > auxDate) || (auxDate > toDate)){
                            map.removeLayer(element[0]);
                        }
                    });
                }
            }
            else {
                $( "#from" ).addClass( "ui-state-error" );
                $( "#to" ).addClass( "ui-state-error" );
                $( "#dialog-filter-not-selected" ).dialog( "open");
                modal_open = true;
            }
        }

        
        /*-------------------------------------------
          Back-end communication callback functions
        -------------------------------------------*/
        
        function loginOk(data) {
                    
            // Save user as logged in
            localStorage.user_logged_in = true;
            localStorage.user_name = name_login.val();
                    
            $("#sign_in_button").hide();
            $("#signed_in_text").show();
            $("#user_name_navtext").text(name_login.val());
                    
            // Show/hide the proper div
            dialogLogin.dialog( "close" );
            modal_open = false;
         }
         
         function loginFail (errMsg) {   
         
            updateTips( errMsg );
            
        }
        
        function signupOk(data) {
                    
            // Save user as logged in
            localStorage.user_logged_in = true;
            localStorage.user_name = name_signup.val();
                
            $("#sign_in_button").hide();
            $("#signed_in_text").show();
            $("#user_name_navtext").text(name_signup.val());
                
            dialogSignup.dialog( "close" );
            modal_open = false;
         }
         
         function signupFail (errMsg) {   
         
            updateTips( errMsg );
            
        }
        
        function addreportOk(data) {
                    
            var markerReport = L.marker(latlng_aux).addTo(map);
            markerReport.bindPopup("<b>User: <span class='user_link' onclick=showUser('"+data["user"]+"')>"+data["user"]+"</span><br><b>Type</b>: " + data["type"] + "<br><b>Date</b>: " + data["report_date"] +
                          "<br><b>Intensity</b> (1 - 6): " + data["intensity"] + "<br><b>Annoyance (-4 - 4)</b>: " + data["annoyance"] + "<br><b>Number of comments</b>: " + data["number_comments"]);
                          
            $('#reports').append($('<div>', {
                    html: '<b>User</b>: <span class="user_link" onclick=showUser("'+data["user"]+'")>'+data["user"]+'</span>'+
                          '<br><b>Date</b>: '+data["report_date"]+
                          '<br><b>Type</b>: '+data["type"]+
                          '<br><b>Intensity (1 - 6)</b>: '+data["intensity"]+
                          '<br><b>Annoyance (-4 - 4)</b>: '+data["annoyance"]+
                          '<br><b>Number of comments</b>: '+data["number_comments"]
                }).addClass("report"));
            
            // Empty pager and populate it again with the new addition
            numItems = listElement.children().size();
            numPages = Math.ceil(numItems/perPage);
            
            $('.pager').empty();
            
            $('.pager').data("curr",0);

            curr = 0;
            while(numPages > curr){
              $('<li><a href="#" class="page_link">'+(curr+1)+'</a></li>').appendTo('.pager');
              curr++;
            }

            $('.pager .page_link:first').addClass('active');

            listElement.children().css('display', 'none');
            listElement.children().slice(0, perPage).css('display', 'inline-block');

            $('.pager li a').click(function(){
              var clickedPage = $(this).html().valueOf() - 1;
              goTo(clickedPage,perPage);
            });
            
            goTo(numPages-1);
            
            dialogAddreport.dialog( "close" );

            // Notify report recording to the user
            $( "#dialog-recorded" ).dialog( "open");
            
            modal_open = true;
            adding_report = false;

         }
         
         function addreportFail (errMsg) {   
         
            updateTips( errMsg );
            
        }
        
        function getuserOk(data) {
            
            $('#user_info').empty();
            
            $('#user_info').append($('<div>', {
                        html: '<b>Username</b>: '+data["username"]+
                              '<br><b>Email</b>: '+data["email"]+
                              '<br><b>Age</b>: '+data["age"]+
                              '<br><b>Gender</b>: '+data["gender"]+
                              '<br><b>Signup Date</b>: ' +data["signup_date"]
                    }));
            
            $('#user_reports').empty();
            
            user_reports_array = JSON.parse(data["reports"]);
            
            $.each(user_reports_array, function(index, element) {
                    $('#user_reports').append($('<div>', {
                        html: '<b>Date</b>: '+element.report_date+
                              '<br><b>Type</b>: '+element.type+
                              '<br><b>Intensity (1 - 6)</b>: '+element.intensity+
                              '<br><b>Annoyance (-4 - 4)</b>: '+element.annoyance+
                              '<br><b>Number of comments</b>: ' +element.number_comments
                    }).addClass("report_user").click(function() {
                        showReport(element.report_id);
                    }));
            });
            
            /*---------------------------------------
                Pagination while loading
                http://stackoverflow.com/questions/17390179/using-bootstrap-to-paginate-a-set-number-of-p-elements-on-a-webpage
            ---------------------------------------*/
                
            userNumItems = userListElement.children().size();
            userNumPages = Math.ceil(userNumItems/userPerPage);
                
            $('.user_pager').data("userCurr",0);

            userCurr = 0;
            while(userNumPages > userCurr){
              $('<li><a href="#" class="page_link" id="user_pager-'+(userCurr+1)+'">'+(userCurr+1)+'</a></li>').appendTo('.user_pager');
              userCurr++;
            }

            $('.user_pager .page_link:first').addClass('active');

            userListElement.children().css('display', 'none');
            userListElement.children().slice(0, userPerPage).css('display', 'inline-block');

            $('.user_pager li a').click(function(){
                var clickedPage = $(this).html().valueOf() - 1;
                userGoTo(clickedPage,userPerPage);
            });        
         }
         
         function getuserFail (errMsg) {   
         
            alert( errMsg );
            
        }
        
        function getreportOk(data) {
            
            $('#report_info').empty();
            $('textarea#add_comment_textarea').val('');
            
            localStorage.report_id = data["report_id"];
            
            $('#report_info').append($('<div>', {
                        html: '<b>Username</b>: <span class="user_link" onclick=showUser("'+data["username"]+'")>'+data["username"]+'</span>'+
                              '<br><b>Annoyance</b>: '+data["annoyance"]+
                              '<br><b>Intensity</b>: '+data["intensity"]+
                              '<br><b>Duration</b>: '+data["duration"]+
                              '<br><b>Origin</b>: '+data["origin"]+
                              '<br><b>Type</b>: '+data["type"]+
                              '<br><b>Report date</b>: '+data["report_date"]+
                              '<br><b>Latitude</b>: '+data["latitude"]+
                              '<br><b>Longitude</b>: '+data["longitude"]+
                              '<br><b>Cloud</b>: '+data["cloud"]+
                              '<br><b>Rain</b>: '+data["Rain"]+
                              '<br><b>Wind</b>: '+data["wind"]
                    }));
                    
                    
// Pic????????                    
    
            
            $('#report_comments').empty();
            
            user_reports_array = JSON.parse(data["comments"]);
            
            $.each(user_reports_array, function(index, element) {
                    $('#report_comments').append($('<div>', {
                        html: '<b>Comment</b>: '+element.comment+
                              '<br><b>User</b>: <span class="user_link" onclick=showUser("'+element.username+'")>'+element.username+'</span>'+
                              '<br><b>Date</b>: '+element.comment_date
                    }).addClass("comment_report"));
            });
         }
         
         function getreportFail (errMsg) {   
         
            alert( errMsg );
            
        }
        
        function addcommentOk(data) {
            
            $('#report_comments').append($('<div>', {
                html: '<b>Comment</b>: '+data["comment"]+
                    '<br><b>User</b>: <span class="user_link" onclick=showUser("'+data["username"]+'")>'+data["username"]+'</span>'+
                    '<br><b>Date</b>: '+data["comment_date"]
                }).addClass("comment_report"));
            
            $('textarea#add_comment_textarea').val('');
         }
        
        function addcommentFail (errMsg) {   
         
            alert( errMsg );
            
        }
        
        // Request to get the reports to be displayed in the main page
        $.get(urlReports, function(data){

            data = JSON.parse(data);
            $.each(data, function(index, element) {
                $('#reports').append($('<div>', {
                    html: '<b>User</b>: <span class="user_link" onclick=showUser("'+element.user+'")>'+element.user+'</span>'+
                          '<br><span class="report_clickable_area" onclick=showReport("'+element.report_id+'")><b>Date</b>: '+element.report_date+
                          '<br><b>Type</b>: '+element.type+
                          '<br><b>Intensity (1 - 6)</b>: '+element.intensity+
                          '<br><b>Annoyance (-4 - 4)</b>: '+element.annoyance+
                          '<br><b>Number of comments</b>: ' +element.number_comments + '</span>'
                }).addClass("report"));
                
                var latlng_marker = L.latLng(element.latitude, element.longitude);
                
                var markerReport = L.marker(latlng_marker).addTo(map);
                markerReport.bindPopup("<b>User</b>: <span class='user_link' onclick=showUser('"+element.user+"')>"+element.user+"</span><br><b>Type</b>: " + element.type + "<br><b>Date</b>: " + element.report_date +
                          "<br><b>Intensity</b> (1 - 6): " + element.intensity + "<br><b>Annoyance (-4 - 4)</b>: " + element.annoyance + "<br><b>Number of comments</b>: " + element.number_comments);
                
                markerArray.push(new Array (markerReport, element.type, element.report_date));
                
                });
            
            /*---------------------------------------
              Pagination while loading
              http://stackoverflow.com/questions/17390179/using-bootstrap-to-paginate-a-set-number-of-p-elements-on-a-webpage
            ---------------------------------------*/
            
            numItems = listElement.children().size();
            numPages = Math.ceil(numItems/perPage);
            
            $('.pager').data("curr",0);

            curr = 0;
            while(numPages > curr){
              $('<li><a href="#" class="page_link" id="pager-'+(curr+1)+'">'+(curr+1)+'</a></li>').appendTo('.pager');
              curr++;
            }

            $('.pager .page_link:first').addClass('active');

            listElement.children().css('display', 'none');
            listElement.children().slice(0, perPage).css('display', 'inline-block');

            $('.pager li a').click(function(){
              var clickedPage = $(this).html().valueOf() - 1;
              goTo(clickedPage,perPage);
            });
        });
        
        /*---------------------------------------
              Pagination functions while use of the app
              http://stackoverflow.com/questions/17390179/using-bootstrap-to-paginate-a-set-number-of-p-elements-on-a-webpage
            ---------------------------------------*/
        
        function previous(){
            var goToPage = parseInt($('.pager').data("curr")) - 1;
            if($('.active').prev('.page_link').length==true){
                goTo(goToPage);
            }
        }

        function next(){
            goToPage = parseInt($('.pager').data("curr")) + 1;
            if($('.active_page').next('.page_link').length==true){
                goTo(goToPage);
            }
        }

        function goTo(page){
            var startAt = page * perPage,
                endOn = startAt + perPage;
              
            listElement.children().css('display','none').slice(startAt, endOn).css('display','inline-block');
            $('.pager').attr("curr",page);
            $(".pager li a").removeClass("active");
            // Increment page to fit the id
            page++;
            $('#pager-'+page).addClass('active');
            
        }

        function userReportsGoTo(page){
            var startAt = page * userPerPage,
                endOn = startAt + userPerPage;
              
            userReportListElement.children().css('display','none').slice(startAt, endOn).css('display','inline-block');
            $('.user-pager').attr("curr",page);
            $(".user-pager li a").removeClass("active");
            // Increment page to fit the id
            page++;
            $('#user-pager-'+page).addClass('active');
            
        }
        
        /*---------------------------------------
          Initialization
        ---------------------------------------*/
        
        // Init forms, inputs, sliders and labels
        $("option:selected").removeAttr("selected");
        formLogin[ 0 ].reset();
        formSignup[ 0 ].reset();
        $('#age_signup>option:eq(0)').prop('selected', true);
        $('#gender_signup>option:eq(0)').prop('selected', true);
        formAddreport[ 0 ].reset();
        $('#type_addreport>option:eq(0)').prop('selected', true);
        $('#duration_addreport>option:eq(0)').prop('selected', true);
        
        $('#type_filter>option:eq(0)').prop('selected', true);
        $( "#from" ).datepicker('setDate', null);
        $( "#to" ).datepicker('setDate', null);
        
        $('#from').val('');
        $('#to').val('');
        
        $("#intensity_addreport").slider('value',1);
        $("#annoyance_addreport").slider('value',-4);
        $("#cloud_addreport").slider('value',1);
        $("#rain_addreport").slider('value',0);
        $("#wind_addreport").slider('value',0);
        
        $( "#intensity_text" ).text( 1 );
        $( "#annoyance_text" ).text( -4 );
        $( "#cloud_text" ).text( 1 );
        $( "#rain_text" ).text( 0 );
        $( "#wind_text" ).text( 0 );
    </script>
</body>
</html>

